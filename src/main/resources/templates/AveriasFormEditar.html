<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/layout :: head"></head>
	<body>
	<header th:replace="layout/layout :: header"></header>
	<br>

	<!--/* CHAT FLOTANTE */-->
	<button class="floating-button" onclick="toggleIframe()" style="position: fixed !important; bottom: 20px !important; right: 20px !important; background-color: #fff !important; color: #007bff !important; border: none !important; border-radius: 50% !important; width: 50px !important; height: 50px !important; font-size: 24px !important; text-align: center !important; line-height: 50px !important; cursor: pointer !important; z-index: 9999 !important;">
		<img src="/img/iconchatgpt.png" alt="Icono" style="width: 100%;">
	</button>

	<div id="iframeContainer" class="card shadow-lg rounded" style="display: none; position: fixed; bottom: 100px; right: 20px; z-index: 9999; width: 350px; height: 500px;">
		<div class="card-header text-white" style="#17A2B8;">
			ASISTENTE
			<button type="button" class="close text-white" aria-label="Close" onclick="toggleIframe()">
				<span aria-hidden="true">&times;</span>
			</button>
		</div>
		<!-- iframe flotante -->
		<div class="card-body p-0 border-0 rounded" style="width: 350px; height: 450px;">
			<iframe src="/chatbot" class="w-100 h-100 border-0 rounded" style="background-color: #fff;"></iframe>
		</div>
	</div>
	<!--/* CHAT FLOTANTE */-->
		<main class="container">
			<form th:action="@{/averias/grabar}" th:object=${averias} method="post" id="formCategoria">
				<section class="card">
				<div class="card-header">
				<h3>REGISTRO DE AVERIA</h3>
						
				<br><br>
				
				</div>
					<div class="card-body">
					<div class="form-group">						
						<input th:field="*{averiaid}" id="txtnombre" type="text" class="form-control" required="required" hidden="hidden">
					</div>
					
					<div class="form-group">
						<label>INC</label>
						<input th:field="*{inc}" id="txtnombre" type="text" class="form-control" required="required">
					</div>
					
					<div class="form-group">
					<label>SISEGO</label>
						<input th:field="*{sisego}" id="txtestado" type="text" class="form-control" required="required">
					</div>
								
					<div class="form-group">
						<label>ZONAL</label>
						<input th:field="*{zonal}" id="vendedor11" type="text" class="form-control">
					</div>			
												
					<div class="form-group">
						<label>ZONIFICACION</label>						
						
						<select th:field="*{zonificacion}" class="form-control" required="required">
						<option value="-">--SELECCIONE--</option>
						<option value="urbano">URBANO</option>
						<option value="interurbano">INTERURBANO</option>
						<option value="rural">RURAL</option>					
						</select>
					</div>
					<div class="form-group">
						<label>CONTRATA</label>
						<select th:field="*{contrata}" id="cboCategoria" class="form-control">
						<option value="">SELECCIONE...</option>
						<option th:each="users:${users}"
						th:value="${users.username}"
						th:text="${users.username}"
						/>
					</select>
					</div>										
					<div class="form-group">
						<label>TECNICO ASIGNADO</label>
						<input th:field="*{tecnicoAsignado}" id="vendedor11" type="text" class="form-control">
					</div>																									
					<div class="form-group">
						<label>FECHA DE ATENCION</label>
						<input th:field="*{fechaAtencion}" id="vendedor11" type="date" class="form-control">
					</div>		
					
					<div class="form-group">
						<label>FECHA FINALIZACION</label>
						<input th:field="*{fechafinalizacion}" id="fechaActual2" type="date" class="form-control">
					</div>	
					
					<div class="form-group">
						<label>TIPO DE AVERIA</label>												
						<select th:field="*{tipoAveria}" class="form-control" required="required">
						<option value="-">--SELECCIONE--</option>
						<option value="modem">MODEM</option>
						<option value="umg">UMG</option>
						<option value="router">ROUTER</option>					
						</select>
					</div>
					
					<div class="form-group">
						<label>DIAGNOSTICO</label>
						<input th:field="*{diagnostico}" id="vendedor11" type="text" class="form-control">
					</div>
					<div class="form-group">
						<label>PARADA DE RELOJ</label>
						<select th:field="*{paradaReloj}" class="form-control" required="required">
						<option value="-">--SELECCIONE--</option>
						<option value="si">SI</option>
						<option value="no">NO</option>										
						</select>
					</div>
					<div class="form-group">
						<label>ACCIONES CORRECTIVAS</label>
						<input th:field="*{accionesCorrectivas}" id="vendedor11" type="text" class="form-control">
					</div>
					
					<div class="form-group" hidden="hidden">
						<label>FECHA PARA FINALIZACION</label>
						<input th:field="*{fechaparafinalizar}" id="fechaActual" type="date" class="form-control">
					</div>	
					
					<div class="form-group">
						<label>ESTADO</label>
						<select th:field = "*{estado}" id = "estatus" class="form-control">
							<option value="-">--SELECCIONE--</option>
							<option value="EJECUTADO">EJECUTADO</option>
							<option value="PENDIENTE">PENDIENTE</option>
						</select>
					</div>
					<div class="form-group">
						<label>OBSERVACIONES</label>
						<input th:field="*{cliente}" id="vendedor11" type="text" class="form-control">
					</div>
					
					
					<div class="form-group">
						<label>CLIENTE</label>
						<input th:field="*{observaciones}" id="vendedor11" type="text" class="form-control">
					</div>
					
						<div class="form-group">
						<label>DIRECCION</label>
						<input th:field="*{direccion}" id="vendedor11" type="text" class="form-control">
					</div>
					
					<div class="form-group">
						<label>DEPARTAMENTO</label>
						<select th:field="*{departamento}" id="cboDepartamento" class="form-control" required="required">
						<option value="">SELECCIONE...</option>
						<option th:each="departamentos:${departamentos}"
						th:value="${departamentos.codDepartamento}"
						th:text="${departamentos.nombreDepartamento}"
						/>
					</select>
					</div>
					<div class="form-group">
						<label>PROVINCIA</label>
						<select th:field="${provincia}"  id="cboProvincia" class="form-control" required="required">
						<option value="">SELECCIONE...</option>
						<option th:each="provinc:${provincias}"
						th:value="${provinc.codProvincia}"
						th:text="${provinc.nombreProvincia}"
						/>
					</select>
					</div>	
					<div class="form-group">
						<label>DISTRITO</label>
						<select th:field="*{distrito}" id="cboDistrito" class="form-control" required="required">
						<option value="">SELECCIONE...</option>
						<option th:each="distrit:${distritos}"
						th:value="${distrit.nombreDistrito}"
						th:text="${distrit.nombreDistrito}"
						/>
					</select>
					</div>		

					
					<div class="form-group">
						<label>RESPONSABLE</label>
						<input th:field="*{responsable}" id="vendedor11" type="text" class="form-control">
					</div>
					
					<div class="form-check form-check-inline">
					  <input class="form-check-input" th:field="*{materiales}" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="CON MATERIALES">
					  <label class="form-check-label" for="inlineRadio1">CON MATERIALES</label>
					</div>
					<div class="form-check form-check-inline">
					  <input class="form-check-input" th:field="*{materiales}" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="SIN MATERIALES">
					  <label class="form-check-label" for="inlineRadio2">SIN MATERIALES</label>
					</div>
					
					</div>
					<div class="card-footer">
						<input type="submit" value="REGISTRAR" class="btn btn-primary">
						
						<input type="button" value="CANCELAR" onclick="cancelar()" class="btn btn-danger">
					</div>
				</section>
			</form><br><br><br>
		</main>

	<!--/* CHAT FLOTANTE */-->
	<script>
		function toggleIframe() {
            var iframeContainer = document.getElementById('iframeContainer');
            if (iframeContainer.style.display === 'none' || iframeContainer.style.display === '') {
                iframeContainer.style.display = 'block';
            } else {
                iframeContainer.style.display = 'none';
            }
        }
	</script>
	<!--/* CHAT FLOTANTE */-->
	</body>
	<script th:inline="javascript">
	/*<![CDATA[*/
	  let codprovincia= /*[[${provincia}]]*/ "provincia";
	  
	  /*]]>*/</script>
	<script type="text/javascript" th:src="@{/js/script.js}"></script>
	<script type="text/javascript">
	
	
	$( document ).ready(function() {
		debugger;
		//listarProvincias($("#cboDepartamento").val());
		
		
		let num =0;
		if(num == 0){
			
				$("#cboProvincia").val(codprovincia);		
			num++;
		}else{
			$("#cboDepartamento").change(function(){
				listarProvincias($(this).val());
				})

				$("#cboProvincia").change(function(){
				listarDistritos($(this).val());
				})
			
		}
			  
	});
	
	
	function listarProvincias(codDepa){

		$("#cboProvincia").children().remove();
		$("#cboProvincia").append("<option value>SELECCIONE...</option>");
		$("#cboDistrito").children().remove();
		$("#cboDistrito").append("<option value>SELECCIONE...</option>");

		$.ajax({
		url: "/listarProvincias/" + codDepa,
		dataType: "json",
		}).done( 
		function(result){
		$.each(result, function(indice, valor){
		$("#cboProvincia").append("<option value='" + valor.codProvincia + "'>" + valor.nombreProvincia + "</option>" )
		})
		}
		)
		    }

		    function listarDistritos(codProv){
		$("#cboDistrito").children().remove();
		$("#cboDistrito").append("<option value>SELECCIONE...</option>");

		$.ajax({
		url: "/listarDistritos/" + codProv,
		dataType: "json",
		}).done( 
		function(result){
		$.each(result, function(indice, valor){
		$("#cboDistrito").append("<option value='" + valor.nombreDistrito + "'>" + valor.nombreDistrito + "</option>" )
		})
		}
		)
		    }
	window.onload = function(){
		  var fecha = new Date(); //Fecha actual
		  var mes = fecha.getMonth()+1; //obteniendo mes
		  var dia = fecha.getDate(); //obteniendo dia
		  var ano = fecha.getFullYear(); //obteniendo a�o
		  if(dia<10)
		    dia='0'+dia; //agrega cero si el menor de 10
		  if(mes<10)
		    mes='0'+mes //agrega cero si el menor de 10
		  document.getElementById('fechaActual').value=ano+"-"+mes+"-"+dia;	  
	}
	</script>
	
</html>